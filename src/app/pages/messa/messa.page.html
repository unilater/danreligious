<ion-header>
  <ion-toolbar color="light">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/tab1"></ion-back-button>
    </ion-buttons>
    <ion-title>Letture della Messa</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>

  <!-- alias 'lit' per evitare ?. all'interno -->
  <ng-container *ngIf="!loading && !error && liturgia as lit; else stateTpl">

    <div style="text-align:center;padding:16px">
      <ion-chip [color]="lit.color_key || 'medium'">
        <ion-label>{{ lit.color_label }}</ion-label>
      </ion-chip>
      <div style="opacity:.8;display:inline-flex;gap:.5rem;align-items:center">
        <span>{{ date }}</span>
        <span>•</span>
        <span>{{ lit.season }}</span>
        <span *ngIf="lit.week">•</span>
        <span *ngIf="lit.week">{{ lit.week }}</span>
        <span *ngIf="lit.festa">•</span>
        <span *ngIf="lit.festa">{{ lit.festa }}</span>
      </div>
    </div>

    <ion-list lines="none" *ngIf="lit.letture?.length">
      <ion-item *ngFor="let l of lit.letture">
        <ion-label>
          <div><strong>{{ l.tipo }}</strong></div>
          <div style="font-style:italic;opacity:.8">{{ l.riferimento }}</div>

          <div *ngIf="hasText(l)" style="margin-top:8px;line-height:1.5">
            <div *ngIf="l.testo" [innerHTML]="l.testo"></div>
            <pre *ngIf="!l.testo && l.snippet" style="white-space:pre-wrap;margin:0">{{ l.snippet }}</pre>
          </div>
        </ion-label>
      </ion-item>
    </ion-list>

  </ng-container>

  <ng-template #stateTpl>
    <div style="display:grid;place-items:center;padding:24px;text-align:center">
      <ion-spinner *ngIf="loading" name="crescent"></ion-spinner>
      <ion-note color="danger" *ngIf="error">{{ error }}</ion-note>
    </div>
  </ng-template>

</ion-content>
