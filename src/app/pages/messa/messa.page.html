<ion-header class="parchment-header">
  <ion-toolbar color="light">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/tab1"></ion-back-button>
    </ion-buttons>
    <ion-title class="vintage-title">
      <ion-icon name="book-outline"></ion-icon>
      Letture della Messa
    </ion-title>
  </ion-toolbar>
</ion-header>

<!-- usa la classe per lo sfondo tipo pergamena -->
<ion-content class="parchment-body">

  <!-- alias 'lit' per evitare ?. all'interno -->
  <ng-container *ngIf="!loading && !error && liturgia as lit; else stateTpl">

    <!-- testatina con chip e metadati -->
    <div class="header-meta">
      <ion-chip class="chip-liturgical" [ngClass]="'lit-' + (lit.color_key || 'neutral')">
        <ion-label>{{ lit.color_label }}</ion-label>
      </ion-chip>

      <div class="meta-line">
        <span class="meta-date">{{ date }}</span>
        <span class="dot">•</span>
        <span class="meta-season">{{ lit.season }}</span>
        <span class="dot" *ngIf="lit.week">•</span>
        <span *ngIf="lit.week">{{ lit.week }}</span>
        <span class="dot" *ngIf="lit.festa">•</span>
        <span *ngIf="lit.festa">{{ lit.festa }}</span>
      </div>
    </div>

    <!-- elenco letture -->
    <ion-list class="list-vintage" lines="none" *ngIf="lit.letture?.length">
      <ion-item class="reading" *ngFor="let l of lit.letture">
        <ion-icon slot="start" name="bookmark-outline"></ion-icon>
        <ion-label>
          <div class="reading-type">{{ l.tipo }}</div>
          <div class="reading-ref">{{ l.riferimento }}</div>

          <div class="prose" *ngIf="hasText(l)">
            <div *ngIf="l.testo" [innerHTML]="l.testo"></div>
            <pre *ngIf="!l.testo && l.snippet">{{ l.snippet }}</pre>
          </div>
        </ion-label>
      </ion-item>
    </ion-list>

  </ng-container>

  <!-- stati: loading / errore -->
  <ng-template #stateTpl>
    <div class="state">
      <ion-spinner *ngIf="loading" name="crescent"></ion-spinner>
      <ion-note color="danger" *ngIf="error">{{ error }}</ion-note>
    </div>
  </ng-template>

</ion-content>
