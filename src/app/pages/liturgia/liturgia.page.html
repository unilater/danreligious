<!-- HEADER: una sola barra con data -->
<ion-header class="parchment-header">
  <ion-toolbar color="light">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/tab2"></ion-back-button>
    </ion-buttons>
    <ion-title class="vintage-title">
      <ion-icon name="book-outline"></ion-icon>
      Liturgia — {{ date | date:'EEEE d MMMM yyyy':'Europe/Rome':'it-IT' | titlecase }}
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="parchment-body" [fullscreen]="true">
  <ng-container *ngIf="!loading && !error; else stateTpl">

    <!-- ========== LITURGIA ========== -->
    <ion-card class="card-vintage liturgia-card" *ngIf="liturgia as lit">
      <ion-card-header>
        <ion-card-title class="section-title">
          <ion-icon name="shield-checkmark-outline"></ion-icon>
          Liturgia
        </ion-card-title>

        <ion-chip class="chip-liturgical" [ngClass]="litColorClass(lit)" aria-label="Colore liturgico">
          <ion-label>{{ lit.color_label || lit.color_key || '—' }}</ion-label>
        </ion-chip>
      </ion-card-header>

      <ion-card-content>
        <div class="kv-table">
          <div class="kv-row">
            <div class="kv-key">TEMPO</div>
            <div class="kv-val">{{ lit.season }}</div>
          </div>
          <div class="kv-row" *ngIf="lit.week">
            <div class="kv-key">SETTIMANA</div>
            <div class="kv-val">{{ lit.week }}</div>
          </div>
        </div>

        <div class="festa-badge" *ngIf="lit.festa">
          {{ lit.festa | uppercase }}
        </div>

        <div class="readings" *ngIf="lit.letture?.length">
          <div class="reading-block" *ngFor="let l of lit.letture | slice:0:3">
            <div class="r-head">
              <div class="r-tipo">{{ l.tipo }}</div>
              <div class="r-ref">{{ l.riferimento }}</div>
            </div>
            <div class="r-body" *ngIf="l.snippet" [innerHTML]="l.snippet"></div>
          </div>
        </div>

        <ion-button size="small" fill="outline" [routerLink]="['/messa', date]" class="btn-primary">
          Vai al dettaglio letture
          <ion-icon name="chevron-forward-outline" slot="end" aria-hidden="true"></ion-icon>
        </ion-button>
      </ion-card-content>
    </ion-card>

    <!-- ========== SANTI ========== -->
    <ion-card class="card-vintage santi-card" *ngIf="santi.length > 0">
      <ion-card-header>
        <ion-card-title class="section-title">
          <ion-icon name="ribbon-outline"></ion-icon>
          Santi del giorno
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="saints-list">
          <a
            class="saint-card"
            *ngFor="let s of (santi | slice:0:2); trackBy: trackBySanto"
            [routerLink]="['/santo', date, s.id]"
          >
            <div class="s-title dropcap">{{ s.titolo }}</div>
            <div class="s-sub" *ngIf="s.sottotitolo">{{ s.sottotitolo }}</div>
            <div class="s-snippet" *ngIf="s.snippet">{{ s.snippet }}</div>
          </a>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- ========== NATURA & CAMPI ========== -->
    <ion-card class="card-vintage natura-v3" *ngIf="natura as nat">
      <ion-card-header>
        <ion-card-title class="section-title">
          <ion-icon name="leaf-outline"></ion-icon>
          Natura & Campi
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="folio">
          <div class="spine" aria-hidden="true"></div>
          <ul class="folio-list">
            <li class="folio-item orto" *ngIf="nat.orto">
              <div class="item-title">ORTO</div>
              <div class="item-text">{{ nat.orto }}</div>
            </li>
            <li class="folio-item giardino" *ngIf="nat.giardino">
              <div class="item-title">GIARDINO</div>
              <div class="item-text">{{ nat.giardino }}</div>
            </li>
            <li class="folio-item piante" *ngIf="nat.piante">
              <div class="item-title">PIANTE</div>
              <div class="item-text">{{ nat.piante }}</div>
            </li>
            <li class="folio-item cucina" *ngIf="nat.cucina">
              <div class="item-title">CUCINA</div>
              <div class="item-text">{{ nat.cucina }}</div>
            </li>
            <li class="folio-item luna" *ngIf="nat.lunaFase || nat.lunaEmoji">
              <div class="item-title">LUNA</div>
              <div class="item-text">
                <span *ngIf="nat.lunaEmoji">{{ nat.lunaEmoji }} </span>{{ nat.lunaFase || '—' }}
              </div>
            </li>
            <li class="folio-item alba" *ngIf="nat.alba">
              <div class="item-title">ALBA</div>
              <div class="item-text">{{ nat.alba }}</div>
            </li>
            <li class="folio-item tramonto" *ngIf="nat.tramonto">
              <div class="item-title">TRAMONTO</div>
              <div class="item-text">{{ nat.tramonto }}</div>
            </li>
          </ul>
        </div>

        <ion-button size="small" fill="outline" [routerLink]="['/natura', date]" class="btn-primary">
          Apri dettaglio Natura
          <ion-icon name="chevron-forward-outline" slot="end" aria-hidden="true"></ion-icon>
        </ion-button>
      </ion-card-content>
    </ion-card>

    <!-- ========== CONSIGLIO DEL MONACO ========== -->
    <ion-card class="card-vintage" *ngIf="proverbio?.consiglio">
      <ion-card-header>
        <ion-card-title class="section-title">
          <ion-icon name="sparkles-outline"></ion-icon>
          Consiglio del Monaco
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <blockquote class="monk-tip">{{ proverbio?.consiglio }}</blockquote>
      </ion-card-content>
    </ion-card>

    <!-- ========== CITAZIONE & PROVERBIO ========== -->
    <ion-card class="card-vintage" *ngIf="proverbio as pro">
      <ion-card-header>
        <ion-card-title class="section-title">
          <ion-icon name="chatbubble-ellipses-outline"></ion-icon>
          Citazione & Proverbio
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <figure class="quote-wrap" *ngIf="pro.citazione">
          <blockquote class="quote">«{{ pro.citazione }}»</blockquote>
          <figcaption class="quote-cap">—</figcaption>
        </figure>

        <div class="proverbio" *ngIf="pro.testo">
          <em>«{{ pro.testo }}»</em>
        </div>
      </ion-card-content>
    </ion-card>

  </ng-container>

  <!-- Stati: loading / errore -->
  <ng-template #stateTpl>
    <div class="state center" aria-live="polite">
      <ion-spinner *ngIf="loading" name="crescent" class="center-spinner"></ion-spinner>
      <ion-note color="danger" *ngIf="error" class="center-note">{{ error }}</ion-note>
    </div>
  </ng-template>
</ion-content>
